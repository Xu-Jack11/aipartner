# 项目计划：AI 中间层平台

## 项目目标
- 构建连接终端用户与多模态 AI 能力的中间层，提供稳定、安全、可扩展的学习辅助服务。
- 核心功能包含：
	1. 实时用户对话与上下文管理。
	2. 基于学习需求的定制化学习计划，并以待办清单形式呈现。
	3. 持续跟踪待办完成度，形成可视化学习进度。
	4. 自动生成用户画像，实现内容与提示词的个性化推荐。
- 技术约束：前端使用 Next.js + Ant Design；后端使用 NestJS；前后端通过 REST API 通信；数据层采用关系型数据库、文档型数据库、向量数据库与对象存储分别保存用户信息、对话记录、知识库、学习计划与多媒体资产。

## 阶段总览

| 阶段 | 关键交付 | 重点说明 |
| --- | --- | --- |
| 1. 需求与架构设计 | 产品需求文档、系统架构图、数据模型草案 | 确认四大核心功能与多库协同方案 |
| 2. 基础设施搭建 | Next.js & NestJS 项目骨架、CI/CD 流水线 | 统一代码规范、环境配置与密钥管理 |
| 3. 数据层实现 | 四类数据库实例与 schema、基础数据访问层 | 定义用户、对话、知识、学习计划数据模型 |
| 4. 后端服务开发 | REST API、业务流程、AI 服务适配器 | 支撑对话、计划生成、进度跟踪、画像更新 |
| 5. 前端功能实现 | 页面路由、组件、状态管理 | 完成对话界面、计划看板、进度仪表、画像面板 |
| 6. 集成与智能能力 | 对接 AI 模型、实现个性化策略 | Prompt 模板、嵌入生成、画像持久化 |
| 7. 质量保障 | 自动化测试、性能与安全评估 | Jest、Playwright、负载测试、权限校验 |
| 8. 上线与运营 | 部署策略、监控告警、反馈闭环 | Vercel/自建集群、Grafana/Sentry、迭代计划 |

## 阶段详情

### 1. 需求与架构设计
- 产出《产品需求说明书》，详述用户角色、场景与验收标准。
- 绘制系统上下游关系、服务边界和数据流，定义 API 契约（OpenAPI）。
- 设计统一身份认证方案（JWT + Refresh Token），预留 RBAC 扩展。
- 规划四类数据库的部署拓扑与访问策略，明确冷热数据分层规则。

### 2. 基础设施搭建
- 初始化 Next.js 15 + Ant Design + Zustand/React Query 前端项目，配置 ESLint/Prettier/Husky。
- 初始化 NestJS 应用，按模块划分为 `auth`、`dialogue`、`planning`、`progress`、`persona`、`knowledge`、`storage` 等域。
- 配置 pnpm workspace 或 mono-repo（可选），统一依赖管理。
- 建立 GitHub Actions / GitLab CI 流程（lint → test → build → deploy）。
- 设置多环境配置（Dev/Staging/Prod）与密钥管理（Vault/Env）。

### 3. 数据层实现
- **关系型数据库（PostgreSQL/MySQL）**：
	- 用户资料、认证凭证、学习计划（结构化表单）。
	- 使用 TypeORM/Prisma 建模，建立迁移脚本。
- **文档型数据库（MongoDB/Cosmos DB）**：
	- 存储原始对话记录、AI 响应、操作日志。
	- 设计索引优化按用户与话题检索。
- **向量数据库（Pinecone/Weaviate/pgvector）**：
	- 保存知识库条目、对话嵌入、用户画像特征。
	- 实现嵌入生成作业与相似度检索接口。
- **对象存储（S3/OSS）**：
	- 存放课程资料、语音/图片资源、导出报告。
	- 规划 CDN 缓存与访问签名策略。

### 4. 后端服务开发
- 搭建 NestJS 模块：
	- `DialogueModule`：会话上下文、AI 模型调用、历史查询。
	- `PlanningModule`：解析学习需求、生成计划任务、任务优先级调整。
	- `ProgressModule`：记录待办完成状态、生成阶段报告、触发提醒。
	- `PersonaModule`：收集交互数据、更新画像标签、暴露推荐接口。
	- `KnowledgeModule`：管理知识库 CRUD、向量入库、检索。
- 定义 DTO、管道、拦截器确保输入输出一致性与安全性。
- 集成第三方 AI 服务（OpenAI、Azure OpenAI、自建模型），封装策略模式支持多模型切换。
- 实现推送/通知机制（邮件/站内信）用于学习提醒。

### 5. 前端功能实现
- 路由结构：`/auth`、`/chat`、`/plan`、`/progress`、`/persona`、`/settings`。
- 对话界面：多轮聊天、提示词模板、上下文标签、会话列表。
- 计划与待办：需求收集表单、自动生成计划、待办清单（状态、优先级、截止日期）、拖拽排序。
- 进度仪表：统计图表（完成率、连续学习天数、知识覆盖度），使用 Ant Design Charts or ECharts。
- 用户画像：画像雷达图、推荐学习路径、偏好标签编辑。
- 状态管理：React Query 同步 REST 数据，Zustand 管理本地 UI/流程状态。
- 国际化与无障碍：保留中英文扩展能力，使用 aria 属性提升可访问性。

### 6. 集成与智能能力
- 打通后端 AI 服务端点，封装通用 `AIService` SDK。
- 构建 Prompt 管理与版本控制机制，对关键对话与计划生成流程进行 A/B 测试。
- 用户画像自动化流程：
	- 监听进度与对话数据 → 生成特征向量 → 入库向量数据库。
	- 根据画像动态调整推荐内容和提示词参数。
- 学习计划迭代：根据待办完成率与反馈自动调整任务难度与节奏。

### 7. 质量保障
- 单元测试：NestJS 服务、管道、守卫；React 组件与 Hook。
- 集成测试：REST API（Supertest）、端到端流程（Playwright）。
- 性能测试：对话接口 QPS、计划生成延迟、向量检索耗时。
- 安全测试：鉴权绕过、越权访问、数据注入、文件上传校验。
- 保障指标：后端测试覆盖率 ≥ 80%，关键路径端到端测试通过。

### 8. 上线与运营
- 部署策略：
	- 前端部署至 Vercel 或静态 CDN。
	- 后端 NestJS + 数据层部署在 Kubernetes/Docker Compose，支持水平扩展。
	- 向量数据库与对象存储使用托管服务以简化运维。
- 监控告警：Prometheus + Grafana、Sentry、Elastic Stack。
- 日志治理：统一 Trace ID，串联前后端请求。
- 反馈机制：埋点 + 用户调研表单，建立需求 Backlog。
- 迭代节奏：双周迭代，例会复盘，维护公开 Roadmap 与 Changelog。

## 依赖与风险
- AI 服务稳定性：准备备用模型供应商与降级策略。
- 数据合规：遵循隐私政策，敏感数据加密存储与脱敏。
- 多数据库一致性：规划事务与消息队列（如 Kafka）确保跨库同步。
- 复杂度控制：里程碑内优先保障核心闭环，避免过度设计。

## 成功指标
- 对话响应时间：P95 < 3s。
- 学习计划生成成功率：≥ 98%。
- 学习进度追踪准确率：≥ 99%。
- 用户留存：首月 N-day 留存 ≥ 40%。
- 系统可用性：99.9% 正常运行时间。
