# AI å­¦ä¹ æ­å­ - æŠ€æœ¯è·¯å¾„ä¸å®ç°æ–¹æ³•æ¦‚è¿°

> è¿™æ˜¯ [repository-technical-report.md](./repository-technical-report.md) çš„ç²¾ç®€ç‰ˆæœ¬ï¼Œæä¾›å¿«é€Ÿäº†è§£é¡¹ç›®çš„æŠ€æœ¯æ¦‚è§ˆã€‚

## ğŸ¯ é¡¹ç›®ç®€ä»‹

**AI å­¦ä¹ æ­å­** æ˜¯ä¸€ä¸ªæ™ºèƒ½å­¦ä¹ è¾…åŠ©å¹³å°ï¼Œç»“åˆ Next.js 15 å‰ç«¯å’Œ NestJS åç«¯ï¼Œæä¾›ï¼š

- ğŸ’¬ **AI æ™ºèƒ½å¯¹è¯** - å¤šè½®å¯¹è¯ï¼ŒçŸ¥è¯†ç­”ç–‘
- ğŸ“‹ **å­¦ä¹ è®¡åˆ’ç”Ÿæˆ** - AI è‡ªåŠ¨ç”Ÿæˆç»“æ„åŒ–å­¦ä¹ è®¡åˆ’
- ğŸ“Š **è¿›åº¦è¿½è¸ª** - å­¦ä¹ æ—¶é•¿ç»Ÿè®¡ã€è¿ç»­å¤©æ•°è®¡ç®—
- ğŸ“ **å­¦ä¹ æ€»è§ˆ** - ç»¼åˆå­¦ä¹ æ•°æ®åˆ†æ

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„

```
å‰ç«¯ (Next.js 15)  â†â†’  åç«¯ (NestJS 10)  â†â†’  æ•°æ®åº“ (PostgreSQL)
  React 19              REST API              Prisma ORM
  Ant Design            JWT è®¤è¯              å…³ç³»å‹æ•°æ®
  TypeScript            æ¨¡å—åŒ–è®¾è®¡            ç´¢å¼•ä¼˜åŒ–
```

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ |
|------|---------|
| **å‰ç«¯** | Next.js 15 + React 19 + Ant Design 5 + Tailwind CSS 4 |
| **åç«¯** | NestJS 10 + Express + Passport JWT + Prisma 6 |
| **AI** | Vercel AI SDK + OpenAI å…¼å®¹ API |
| **æ•°æ®åº“** | PostgreSQL + Prisma ORM |
| **è¯­è¨€** | TypeScript 5 (å…¨æ ˆ) |
| **ä»£ç è´¨é‡** | Ultracite (Biome) + Husky |
| **åŒ…ç®¡ç†** | pnpm |

## ğŸ“¦ åŠŸèƒ½æ¨¡å—

### 1. è®¤è¯æ¨¡å— (Authentication)
- **æŠ€æœ¯**: JWT + bcryptjs + Passport.js
- **åŠŸèƒ½**: ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€Token éªŒè¯
- **å®‰å…¨**: å¯†ç åŠ å¯†ã€Token è¿‡æœŸç®¡ç†

### 2. AI å¯¹è¯æ¨¡å— (Dialogue)
- **æŠ€æœ¯**: Vercel AI SDK + ä¼šè¯ç®¡ç†
- **åŠŸèƒ½**: 
  - åˆ›å»ºå¯¹è¯ä¼šè¯
  - å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç†
  - AI å›å¤ç”Ÿæˆå’Œå­˜å‚¨
  - Markdown æ¶ˆæ¯æ¸²æŸ“
- **ç‰¹è‰²**: æ”¯æŒå¤šç§ OpenAI å…¼å®¹ API

### 3. å­¦ä¹ è®¡åˆ’æ¨¡å— (Planning)
- **æŠ€æœ¯**: AI ç”Ÿæˆ + ä»»åŠ¡ç®¡ç†
- **åŠŸèƒ½**:
  - ä»å¯¹è¯ç”Ÿæˆå­¦ä¹ è®¡åˆ’
  - è®¡åˆ’æ‹†åˆ†ä¸ºå¯æ‰§è¡Œä»»åŠ¡
  - ä»»åŠ¡çŠ¶æ€ç®¡ç† (todo/in-progress/done)
  - è¿›åº¦è·Ÿè¸ª
- **ç‰¹è‰²**: AI é©±åŠ¨çš„è®¡åˆ’ç”Ÿæˆ

### 4. è¿›åº¦è¿½è¸ªæ¨¡å— (Progress)
- **æŠ€æœ¯**: å­¦ä¹ è®°å½• + ç»Ÿè®¡åˆ†æ
- **åŠŸèƒ½**:
  - è®°å½•å­¦ä¹ ä¼šè¯ï¼ˆæ—¶é•¿ã€ä¸»é¢˜ï¼‰
  - è¿ç»­å­¦ä¹ å¤©æ•°ç®—æ³•
  - å­¦ä¹ ç»Ÿè®¡ï¼ˆæœ¬å‘¨/æœ¬æœˆæ—¶é•¿ï¼‰
  - å­¦ä¹ è¶‹åŠ¿å¯è§†åŒ–
- **ç‰¹è‰²**: æ™ºèƒ½è¿ç»­å¤©æ•°è®¡ç®—

### 5. å­¦ä¹ æ€»è§ˆæ¨¡å— (Learning)
- **æŠ€æœ¯**: æ•°æ®èšåˆ
- **åŠŸèƒ½**: ç»¼åˆå±•ç¤ºè¿›åº¦ã€è®¡åˆ’ã€å¯¹è¯æ•°æ®
- **ç‰¹è‰²**: ä¸€ç«™å¼å­¦ä¹ çŠ¶æ€è§†å›¾

### 6. AI æ¨¡å‹ç®¡ç† (AI Models)
- **æŠ€æœ¯**: åŠ¨æ€æ¨¡å‹åˆ—è¡¨
- **åŠŸèƒ½**: è·å–å¯ç”¨ AI æ¨¡å‹ã€æ”¯æŒåˆ·æ–°
- **ç‰¹è‰²**: æ”¯æŒå¤š AI æä¾›å•†

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

```
User (ç”¨æˆ·)
 â”œâ”€â”€ Session (å¯¹è¯ä¼šè¯)
 â”‚    â””â”€â”€ ChatMessage (æ¶ˆæ¯è®°å½•)
 â”œâ”€â”€ Plan (å­¦ä¹ è®¡åˆ’)
 â”‚    â””â”€â”€ Task (ä»»åŠ¡)
 â”œâ”€â”€ StudySession (å­¦ä¹ è®°å½•)
 â””â”€â”€ ProgressSnapshot (è¿›åº¦å¿«ç…§)
```

### å…³é”®ç‰¹æ€§
- âœ… å¤–é”®çº¦æŸä¿è¯æ•°æ®ä¸€è‡´æ€§
- âœ… å¤åˆç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
- âœ… çº§è”åˆ é™¤è‡ªåŠ¨æ¸…ç†å…³è”æ•°æ®
- âœ… UUID ä¸»é”®é¿å…å†²çª

## ğŸ¨ å‰ç«¯æ¶æ„

### ç›®å½•ç»“æ„
```
src/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ login/              # ç™»å½•é¡µ
â”‚   â”œâ”€â”€ chat/               # å¯¹è¯é¡µ
â”‚   â”œâ”€â”€ plan/               # è®¡åˆ’é¡µ
â”‚   â”œâ”€â”€ progress/           # è¿›åº¦é¡µ
â”‚   â””â”€â”€ persona/            # æ€»è§ˆé¡µ
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ api/                # API å®¢æˆ·ç«¯
â”‚   â””â”€â”€ hooks/              # è‡ªå®šä¹‰ Hooks
â””â”€â”€ types/                  # ç±»å‹å®šä¹‰
```

### è®¾è®¡ç‰¹ç‚¹
- ğŸ“± å“åº”å¼è®¾è®¡ï¼ˆæ”¯æŒå¹³æ¿å’Œæ¡Œé¢ï¼‰
- â™¿ æ— éšœç¢æ€§ (a11y) æ”¯æŒ
- ğŸ¯ ç±»å‹å®‰å…¨ï¼ˆå…¨é‡ TypeScriptï¼‰
- ğŸš€ æ€§èƒ½ä¼˜åŒ–ï¼ˆTurbopack + Server Componentsï¼‰

## ğŸ”§ åç«¯æ¶æ„

### æ¨¡å—ç»“æ„
```
apps/server/src/
â”œâ”€â”€ auth/           # è®¤è¯æ¨¡å—
â”œâ”€â”€ ai/             # AI æœåŠ¡æ¨¡å—
â”œâ”€â”€ dialogue/       # å¯¹è¯æ¨¡å—
â”œâ”€â”€ planning/       # è®¡åˆ’æ¨¡å—
â”œâ”€â”€ progress/       # è¿›åº¦æ¨¡å—
â”œâ”€â”€ learning/       # å­¦ä¹ æ€»è§ˆæ¨¡å—
â”œâ”€â”€ users/          # ç”¨æˆ·æ¨¡å—
â””â”€â”€ prisma/         # æ•°æ®åº“æ¨¡å—
```

### æ¶æ„æ¨¡å¼
- ğŸ—ï¸ **ä¸‰å±‚æ¶æ„**: Controller â†’ Service â†’ Repository
- ğŸ’‰ **ä¾èµ–æ³¨å…¥**: NestJS DI å®¹å™¨
- ğŸ¯ **å•ä¸€èŒè´£**: æ¯ä¸ªæ¨¡å—ä¸“æ³¨ä¸€ä¸ªä¸šåŠ¡åŸŸ
- ğŸ”’ **JWT å®ˆå«**: ç»Ÿä¸€è®¤è¯ä¿æŠ¤

## ğŸ¤– AI æœåŠ¡é›†æˆ

### æ”¯æŒçš„ AI æä¾›å•†
- OpenAI (å®˜æ–¹ API)
- DeepSeek
- Azure OpenAI
- Moonshot AI (Kimi)
- æ™ºè°± AI (GLM)
- é˜¿é‡Œäº‘é€šä¹‰åƒé—®
- LocalAI / Ollama
- å…¶ä»– OpenAI å…¼å®¹æœåŠ¡

### é…ç½®æ–¹å¼
```env
OPENAI_API_KEY=your_api_key
OPENAI_BASE_URL=https://api.provider.com/v1  # å¯é€‰
```

### è®¾è®¡æ¨¡å¼
- ğŸ¨ **ç­–ç•¥æ¨¡å¼**: æŠ½è±¡ AI Provider æ¥å£
- ğŸ”Œ **å¯æ’æ‹”**: æ˜“äºæ·»åŠ æ–°çš„ AI æä¾›å•†
- ğŸ“¡ **æµå¼å“åº”**: æ”¯æŒå®æ—¶è¾“å‡º

## ğŸ“Š æ ¸å¿ƒç®—æ³•

### è¿ç»­å­¦ä¹ å¤©æ•°è®¡ç®—

```typescript
// ç®—æ³•é€»è¾‘ï¼šä»æœ€è¿‘ä¸€æ¬¡å­¦ä¹ æ—¥æœŸå¾€å‰æŸ¥æ‰¾
// é‡åˆ°ä¸­æ–­ï¼ˆç›¸é‚»æ—¥æœŸå·® > 1 å¤©ï¼‰åˆ™åœæ­¢è®¡æ•°
// æ—¶é—´å¤æ‚åº¦: O(n)

const sessions = await prisma.studySession.findMany({
  where: { userId },
  orderBy: { recordedAt: 'desc' }
});

let streak = 0;
let lastDate = null;

for (const session of sessions) {
  const currentDate = dayjs(session.recordedAt).startOf('day');
  
  if (!lastDate) {
    streak = 1;
    lastDate = currentDate;
  } else {
    const daysDiff = lastDate.diff(currentDate, 'day');
    if (daysDiff === 1) {
      streak++;
      lastDate = currentDate;
    } else {
      break;  // ä¸­æ–­åˆ™åœæ­¢
    }
  }
}
```

## ğŸ” å®‰å…¨è®¾è®¡

### è®¤è¯ä¸æˆæƒ
- ğŸ”‘ JWT Token è®¤è¯
- ğŸ”’ å¯†ç  bcrypt åŠ å¯† (salt rounds: 10)
- ğŸ‘¤ ç”¨æˆ·æ•°æ®éš”ç¦»ï¼ˆæ‰€æœ‰æŸ¥è¯¢è‡ªåŠ¨è¿‡æ»¤ userIdï¼‰
- â° Token è¿‡æœŸæ—¶é—´æ§åˆ¶

### è¾“å…¥éªŒè¯
- âœ… class-validator è‡ªåŠ¨éªŒè¯
- ğŸ›¡ï¸ Prisma å‚æ•°åŒ–æŸ¥è¯¢é˜² SQL æ³¨å…¥
- ğŸš« XSS é˜²æŠ¤ï¼ˆå‰ç«¯è½¬ä¹‰ï¼‰

### ç¯å¢ƒå˜é‡
- ğŸ” æ•æ„Ÿä¿¡æ¯ä¸æäº¤åˆ° Git
- ğŸ“ ä½¿ç”¨ .env.example ä½œä¸ºæ¨¡æ¿
- ğŸ­ ç”Ÿäº§ç¯å¢ƒå¼ºåˆ¶å¯†é’¥é…ç½®

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–
- ğŸ“ˆ å¤åˆç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢
- ğŸ” Prisma select å‡å°‘æŸ¥è¯¢å­—æ®µ
- ğŸ“„ åˆ†é¡µæŸ¥è¯¢é¿å…å¤§é‡æ•°æ®åŠ è½½

### å‰ç«¯ä¼˜åŒ–
- âš¡ Turbopack æé€Ÿæ„å»º
- ğŸ¯ ä»£ç åˆ†å‰²è‡ªåŠ¨ä¼˜åŒ–
- ğŸ–¼ï¸ Next.js Image ç»„ä»¶ä¼˜åŒ–

### API ä¼˜åŒ–
- ğŸ”„ æ•°æ®åº“è¿æ¥æ± 
- âš¡ å¼‚æ­¥éé˜»å¡å¤„ç†
- ğŸ­ ä¹è§‚ UI æ›´æ–°

## ğŸ“ˆ ä»£ç è´¨é‡

### ä»£ç è§„èŒƒ
- âœ¨ Ultracite (Biome) ä»£ç æ£€æŸ¥
- ğŸ“ TypeScript ä¸¥æ ¼æ¨¡å¼
- â™¿ æ— éšœç¢æ€§ (a11y) è§„åˆ™
- ğŸ¨ ç»Ÿä¸€ä»£ç æ ¼å¼

### ç±»å‹å®‰å…¨
- ğŸ’¯ å…¨æ ˆ TypeScript
- ğŸ¯ ç«¯åˆ°ç«¯ç±»å‹æ¨æ–­
- ğŸš¨ ç¼–è¯‘æ—¶é”™è¯¯æ£€æµ‹

### Git Hooks
- ğŸ£ Husky é¢„æäº¤æ£€æŸ¥
- âœ… ä»£ç æ ¼å¼åŒ–éªŒè¯
- ğŸ” TypeScript ç±»å‹æ£€æŸ¥

## ğŸ› ï¸ å¼€å‘æµç¨‹

### å¯åŠ¨é¡¹ç›®
```bash
# å®‰è£…ä¾èµ–
pnpm install

# æ•°æ®åº“è¿ç§»
pnpm prisma:generate
pnpm prisma migrate dev

# å¯åŠ¨åç«¯ (http://localhost:4000)
pnpm server:dev

# å¯åŠ¨å‰ç«¯ (http://localhost:3000)
pnpm dev
```

### ä»£ç æ£€æŸ¥
```bash
# æ£€æŸ¥ä»£ç è´¨é‡
pnpm ultracite check

# è‡ªåŠ¨ä¿®å¤
pnpm ultracite fix
```

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬
```bash
# æ„å»ºå‰ç«¯
pnpm build

# æ„å»ºåç«¯
pnpm server:build

# å¯åŠ¨æœåŠ¡
pnpm start              # å‰ç«¯
pnpm server:start       # åç«¯
```

## ğŸ“š API ç«¯ç‚¹æ€»è§ˆ

| æ¨¡å— | ç«¯ç‚¹ | åŠŸèƒ½ |
|------|------|------|
| **Auth** | `POST /api/v1/auth/register` | ç”¨æˆ·æ³¨å†Œ |
| | `POST /api/v1/auth/login` | ç”¨æˆ·ç™»å½• |
| | `GET /api/v1/auth/profile` | è·å–ç”¨æˆ·ä¿¡æ¯ |
| **AI** | `GET /api/v1/ai/models` | è·å–æ¨¡å‹åˆ—è¡¨ |
| **Dialogue** | `POST /api/v1/dialogue/sessions` | åˆ›å»ºä¼šè¯ |
| | `GET /api/v1/dialogue/sessions` | è·å–ä¼šè¯åˆ—è¡¨ |
| | `POST /api/v1/dialogue/sessions/:id/messages` | å‘é€æ¶ˆæ¯ |
| **Planning** | `GET /api/v1/plans` | è·å–è®¡åˆ’åˆ—è¡¨ |
| | `POST /api/v1/plans/generate` | AI ç”Ÿæˆè®¡åˆ’ |
| | `PATCH /api/v1/plans/:id/tasks/:taskId` | æ›´æ–°ä»»åŠ¡çŠ¶æ€ |
| **Progress** | `POST /api/v1/progress/sessions` | è®°å½•å­¦ä¹ ä¼šè¯ |
| | `GET /api/v1/progress/stats` | è·å–ç»Ÿè®¡æ•°æ® |
| | `GET /api/v1/progress/trend` | è·å–è¶‹åŠ¿æ•°æ® |
| **Learning** | `GET /api/v1/learning/summary` | è·å–å­¦ä¹ æ€»è§ˆ |

## âœ¨ é¡¹ç›®äº®ç‚¹

### æ¶æ„è®¾è®¡
- âœ… æ¸…æ™°çš„ä¸‰å±‚æ¶æ„ï¼ŒèŒè´£æ˜ç¡®
- âœ… æ¨¡å—åŒ–è®¾è®¡ï¼Œä½è€¦åˆé«˜å†…èš
- âœ… ä¾èµ–æ³¨å…¥ï¼Œæ˜“äºæµ‹è¯•å’Œæ‰©å±•
- âœ… ç±»å‹å®‰å…¨ï¼Œç«¯åˆ°ç«¯ TypeScript

### åŠŸèƒ½å®ç°
- âœ… AI é©±åŠ¨çš„å­¦ä¹ è®¡åˆ’ç”Ÿæˆ
- âœ… æ™ºèƒ½è¿›åº¦è¿½è¸ªå’Œåˆ†æ
- âœ… å¤š AI æä¾›å•†æ”¯æŒ
- âœ… ä¹è§‚ UI æ›´æ–°ï¼Œå¿«é€Ÿå“åº”

### ä»£ç è´¨é‡
- âœ… ä¼ä¸šçº§ä»£ç è§„èŒƒ
- âœ… ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥
- âœ… æ— éšœç¢æ€§æ”¯æŒ
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†

### ç”¨æˆ·ä½“éªŒ
- âœ… å“åº”å¼è®¾è®¡ï¼Œå¤šè®¾å¤‡é€‚é…
- âœ… Markdown + ä»£ç é«˜äº®
- âœ… åŠ è½½çŠ¶æ€æç¤º
- âœ… æµç•…çš„äº¤äº’ä½“éªŒ

## ğŸ¯ æœªæ¥è§„åˆ’

### çŸ­æœŸè®¡åˆ’
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- [ ] å®Œå–„ API æ–‡æ¡£ (Swagger)
- [ ] æ·»åŠ æ—¥å¿—è®°å½•å’Œç›‘æ§
- [ ] å®ç°è¯·æ±‚é™æµ

### ä¸­æœŸè®¡åˆ’
- [ ] å¤šç§Ÿæˆ· SaaS æ¶æ„
- [ ] çŸ¥è¯†åº“ç®¡ç†åŠŸèƒ½
- [ ] å‘é‡æ•°æ®åº“é›†æˆ (RAG)
- [ ] ç§»åŠ¨ç«¯é€‚é…

### é•¿æœŸè®¡åˆ’
- [ ] å¾®æœåŠ¡æ‹†åˆ†
- [ ] Service Mesh é›†æˆ
- [ ] å¤šæ¨¡æ€ AI (è¯­éŸ³/å›¾åƒ)
- [ ] ç¤¾äº¤å­¦ä¹ åŠŸèƒ½

## ğŸ“– ç›¸å…³æ–‡æ¡£

- ğŸ“„ [å®Œæ•´æŠ€æœ¯æŠ¥å‘Š](./repository-technical-report.md) - è¯¦ç»†çš„æŠ€æœ¯å®ç°è¯´æ˜
- ğŸ“‹ [API å‚è€ƒæ–‡æ¡£](./api-reference.md) - å®Œæ•´ API ç«¯ç‚¹æ–‡æ¡£
- ğŸ”§ [API å®¢æˆ·ç«¯æ–‡æ¡£](./api-clients.md) - å‰ç«¯ API ä½¿ç”¨æŒ‡å—
- ğŸ’¬ [å¯¹è¯åŠŸèƒ½å®ç°](./dialogue-implementation-summary.md) - å¯¹è¯æ¨¡å—è¯¦è§£
- ğŸ“Š [è¿›åº¦æ¨¡å—å®ç°](./progress-module-implementation.md) - è¿›åº¦è¿½è¸ªè¯¦è§£
- ğŸ¤– [AI æä¾›å•†é…ç½®](./ai-provider-configuration.md) - AI æœåŠ¡é…ç½®æŒ‡å—

## ğŸ“Š é¡¹ç›®ç»Ÿè®¡

- **ä»£ç è§„æ¨¡**: ~2700+ è¡Œæ ¸å¿ƒä»£ç 
- **æŠ€æœ¯æ ˆ**: 10+ æ ¸å¿ƒæŠ€æœ¯
- **åŠŸèƒ½æ¨¡å—**: 6 å¤§æ ¸å¿ƒæ¨¡å—
- **API ç«¯ç‚¹**: 20+ ä¸ª REST ç«¯ç‚¹
- **æ•°æ®è¡¨**: 7 ä¸ªæ ¸å¿ƒæ•°æ®è¡¨
- **ç±»å‹å®‰å…¨**: 100% TypeScript

## ğŸ“ é€‚ç”¨åœºæ™¯

æœ¬é¡¹ç›®æ¶æ„é€‚ç”¨äºï¼š
- ğŸ“ åœ¨çº¿æ•™è‚²å¹³å°
- ğŸ¤– AI å¯¹è¯åº”ç”¨
- ğŸ“Š å­¦ä¹ ç®¡ç†ç³»ç»Ÿ
- ğŸ§  çŸ¥è¯†ç®¡ç†å·¥å…·
- ğŸ’¬ æ™ºèƒ½å®¢æœç³»ç»Ÿ
- ğŸ“ å†…å®¹ç”Ÿæˆå¹³å°

---

**æ›´æ–°æ—¶é—´**: 2025-01
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**é¡¹ç›®çŠ¶æ€**: âœ… æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆ

---

> ğŸ’¡ **æç¤º**: æŸ¥çœ‹ [repository-technical-report.md](./repository-technical-report.md) è·å–æ›´è¯¦ç»†çš„æŠ€æœ¯å®ç°è¯´æ˜å’Œä»£ç ç¤ºä¾‹ã€‚
